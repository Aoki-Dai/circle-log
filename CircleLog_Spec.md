# AI Agent Challenge 模擬問題：24時間サークルタイムトラッカー「CircleLog」

## 概要

24時間の行動を円グラフ（24時間時計）で可視化するWebアプリケーション「CircleLog」を実装してください。
ユーザーは1日の活動（睡眠・食事・仕事など）を記録し、24時間の円グラフ上でカラフルなセグメントとして表示します。

**制限時間: 90分**

---

## 技術要件

| 項目 | 指定 |
|------|------|
| 言語 | TypeScript（strict: true） |
| フレームワーク | React (Vite) |
| UIライブラリ | shadcn/ui |
| スタイリング | Tailwind CSS |
| 状態管理 | React hooks（useState / useReducer） |
| テスト | Vitest |
| ビルド | `npm run build` でエラーなし |
| 開発サーバー | `npm run dev` で localhost:5173 で起動 |

---

## データ構造

### Activity（活動記録）

```typescript
type Activity = {
  id: string;              // UUID v4
  name: string;            // 活動名（例: "睡眠", "食事"）
  startHour: number;       // 開始時刻の時（0-23）
  startMinute: number;     // 開始時刻の分（0-59）
  durationMinutes: number; // 活動時間（分単位、1以上1440以下）
  color: string;           // HEXカラーコード（例: "#3B82F6"）
  date: string;            // ISO 8601日付文字列（例: "2026-02-11"）
};
```

### Category（カテゴリ）

```typescript
type Category = {
  id: string;       // UUID v4
  name: string;     // カテゴリ名
  color: string;    // HEXカラーコード
};
```

### デフォルトカテゴリ（初期表示）

アプリ起動時に以下のカテゴリがクイック追加ボタン・カテゴリ選択に表示されていること。

| name | color |
|------|-------|
| 睡眠 | `#3B82F6` |
| 仕事 | `#EF4444` |
| 食事 | `#F59E0B` |
| 休憩 | `#10B981` |
| 運動 | `#8B5CF6` |
| 移動 | `#6B7280` |

---

## 機能要件

### 【Must】必須機能（配点: 70点）

---

#### M1. 24時間円グラフ表示（25点）

- SVGで24時間の円グラフを描画すること
- 円の上端（12時方向）が **0時** を表す
- 時計回りに 0時→1時→…→23時→0時 と進む
- 円の周囲に時刻ラベルを表示する
  - **必須ラベル**: 0, 3, 6, 9, 12, 15, 18, 21（3時間ごと）
- 活動が登録されていない時間帯はグレー（`#E5E7EB`）で表示する
- 円グラフの中央に選択中の日付を `YYYY/MM/DD` 形式で表示する
- 円グラフのサイズは幅・高さともに **400px** とする
- `data-testid="circle-chart"` を円グラフのルートSVG要素に付与する

**描画仕様（SVG arc）:**

各活動は円弧（arc）として描画する。

```
開始角度 = (startHour × 60 + startMinute) / 1440 × 360 - 90   [度]
弧の角度 = durationMinutes / 1440 × 360                        [度]
```

- `-90` は12時方向（上端）を0度とするための補正
- 各セグメントの `data-testid` は `segment-{activity.id}` とする
- SVG `<path>` 要素で `fill` にカテゴリ色を設定する

**計算サンプル:**

```
入力: startHour=0, startMinute=0, durationMinutes=420
開始角度 = (0×60+0)/1440×360 - 90 = -90°（上端）
弧の角度 = 420/1440×360 = 105°
→ 0:00〜7:00 の範囲が塗りつぶされる
```

```
入力: startHour=13, startMinute=30, durationMinutes=60
開始角度 = (13×60+30)/1440×360 - 90 = 112.5°
弧の角度 = 60/1440×360 = 15°
→ 13:30〜14:30 の範囲が塗りつぶされる
```

---

#### M2. 活動の追加（20点）

- 画面上に「追加」ボタン（`data-testid="add-activity-btn"`）を配置する
- ボタン押下で **ダイアログ** を表示する（shadcn/ui の `Dialog` を使用）
- ダイアログのタイトルは `活動を追加`（`data-testid="add-dialog-title"`）
- ダイアログには以下の入力フィールドを配置する:

| フィールド | type | data-testid | バリデーション |
|-----------|------|-------------|--------------|
| カテゴリ選択 | select | `select-category` | 必須（未選択不可） |
| 開始時刻（時） | number input | `input-start-hour` | 0〜23 の整数 |
| 開始時刻（分） | number input | `input-start-minute` | 0〜59 の整数 |
| 活動時間（分） | number input | `input-duration` | 1〜1440 の整数 |

- 「保存」ボタン（`data-testid="save-activity-btn"`）押下で活動を追加する
- **全フィールドが有効な値でない場合、保存ボタンは `disabled` とする**
- 保存成功後:
  1. ダイアログを閉じる
  2. 円グラフに新しいセグメントが即座に反映される
  3. 活動一覧にも即座に反映される
  4. 入力フィールドはリセットされる
- カテゴリ選択時、そのカテゴリの `name` と `color` が活動データに自動的に設定される

---

#### M3. 活動一覧表示（15点）

- 円グラフの下部に、**選択中の日付** の活動をリスト表示する
- 各行に以下を表示する:

| 表示内容 | data-testid | フォーマット |
|---------|-------------|-------------|
| カテゴリカラー（色付き丸、直径12px） | `activity-color-{id}` | background-colorにHEXカラー |
| 活動名 | `activity-name-{id}` | そのまま表示 |
| 開始時刻 | `activity-start-{id}` | `HH:MM`（24時間、ゼロ埋め） |
| 活動時間 | `activity-duration-{id}` | `H:MM`（時間はゼロ埋めなし） |

- リストは **開始時刻の昇順** でソートする
- リストのルート要素に `data-testid="activity-list"` を付与する
- 活動が0件の場合、`data-testid="empty-message"` で「活動が記録されていません」と表示する

**フォーマット詳細:**

| 入力 | 開始時刻表示 | 活動時間表示 |
|------|------------|------------|
| startHour=0, startMinute=0, duration=420 | `00:00` | `7:00` |
| startHour=7, startMinute=0, duration=60 | `07:00` | `1:00` |
| startHour=8, startMinute=30, duration=240 | `08:30` | `4:00` |
| startHour=12, startMinute=0, duration=30 | `12:00` | `0:30` |
| startHour=23, startMinute=45, duration=15 | `23:45` | `0:15` |

**活動時間の変換ロジック:**
```
時間部分 = Math.floor(durationMinutes / 60)
分部分   = durationMinutes % 60
表示     = `${時間部分}:${分部分を2桁ゼロ埋め}`
```

---

#### M4. 活動の削除（10点）

- 各活動行に削除ボタン（`data-testid="delete-activity-{id}"`）を配置する
- 削除ボタン押下で **確認ダイアログ** を表示する（shadcn/ui の `AlertDialog`）
  - メッセージ: `「{活動名}」を削除しますか？`（`data-testid="delete-confirm-message"`）
  - 確認ボタン: `data-testid="confirm-delete-btn"`
  - キャンセルボタン: `data-testid="cancel-delete-btn"`
- 確認ボタン押下で活動を削除する
- 削除後、円グラフと活動一覧を **即座に** 更新する

---

### 【Should】推奨機能（配点: 20点）

---

#### S1. クイック追加ボタン（10点）

- 画面下部にデフォルトカテゴリのクイック追加ボタンを **横並び** で表示する
- 各ボタンの仕様:
  - カテゴリの色を **背景色** とする
  - カテゴリ名をラベルテキストとする
  - テキスト色は白（`#FFFFFF`）とする
  - `data-testid="quick-add-{category.name}"` を付与する
    - 例: `quick-add-睡眠`, `quick-add-仕事`
- ボタン押下で活動追加ダイアログ（M2）を開き、**カテゴリが自動選択された状態** にする
- ボタンコンテナは `overflow-x-auto` で横スクロール可能とする
- コンテナに `data-testid="quick-add-container"` を付与する

---

#### S2. 日付切り替え（10点）

- 円グラフの上部に日付ナビゲーションを配置する
- 配置する要素:

| 要素 | data-testid | 動作 |
|------|-------------|------|
| 前日ボタン（`◀`） | `prev-date-btn` | 選択日を1日前に |
| 日付ラベル | `current-date-label` | 選択中の日付を表示 |
| 次日ボタン（`▶`） | `next-date-btn` | 選択日を1日後に |
| 今日ボタン | `today-btn` | 今日の日付に戻る |

- 日付ラベルのフォーマット: `YYYY/MM/DD (曜日)`
  - 曜日は日本語1文字: `日` / `月` / `火` / `水` / `木` / `金` / `土`
  - 例: `2026/02/11 (水)`
- 日付を切り替えると、**その日の活動データのみ** 表示する
- 円グラフ中央の日付も連動して変わる
- 初期表示は **今日の日付**

---

### 【Could】追加機能（配点: 10点）

---

#### C1. 合計時間表示（5点）

- 画面内に「合計」セクション（`data-testid="summary-section"`）を配置する
- 選択中の日付の活動をカテゴリごとに集計し、以下を表示する:

| 表示内容 | data-testid |
|---------|-------------|
| カテゴリ名 | `summary-name-{category.name}` |
| 合計時間（`H:MM` 形式） | `summary-duration-{category.name}` |
| 24時間中の割合（`XX.X%` 形式） | `summary-percent-{category.name}` |

- **合計時間の降順** でソートする
- 活動が0分のカテゴリは **表示しない**

**割合の計算:**
```
割合 = (カテゴリ合計分数 / 1440) × 100
→ 小数第1位まで表示（例: 29.2%）
```

**サンプル:**

入力データ:
```
睡眠 0:00-7:00 (420分)
食事 7:00-8:00 (60分)
仕事 8:30-16:30 (480分)
食事 12:00-12:30 (30分)  ← 食事カテゴリが2件
```

期待出力:
```
仕事    8:00   33.3%
睡眠    7:00   29.2%
食事    1:30    6.3%
```
- 食事は 60分 + 30分 = 90分 → `1:30`
- 食事の割合: 90/1440×100 = 6.25 → `6.3%`（四捨五入）

---

#### C2. LocalStorageによるデータ永続化（5点）

- 活動データを **localStorage** に保存すること
- キー: `circleLog_activities`
- 値: `Activity[]` の JSON 文字列
- 活動の追加・削除時に即座に localStorage を更新する
- ページリロード後もデータが保持されること
- localStorage が使用不可の場合はメモリのみで動作すること（エラーにならない）

---

## 画面レイアウト

```
┌──────────────────────────────────────┐
│  ◀  2026/02/11 (水)  ▶   [今日]     │  ← 日付ナビゲーション (S2)
├──────────────────────────────────────┤
│                                      │
│         ┌─────────────┐              │
│         │   24時間      │              │
│         │   円グラフ    │              │  ← 円グラフ (M1)
│         │   400x400    │              │
│         │   中央: 日付  │              │
│         └─────────────┘              │
│                                      │
│  [+ 追加]                            │  ← 追加ボタン (M2)
├──────────────────────────────────────┤
│  ● 睡眠   00:00   7:00   [×]        │
│  ● 食事   07:00   1:00   [×]        │  ← 活動一覧 (M3, M4)
│  ● 仕事   08:30   4:00   [×]        │
├──────────────────────────────────────┤
│  合計                                │
│  仕事  8:00  33.3%                   │  ← 合計 (C1)
│  睡眠  7:00  29.2%                   │
├──────────────────────────────────────┤
│ [睡眠][仕事][食事][休憩][運動][移動]  │  ← クイック追加 (S1)
└──────────────────────────────────────┘
```

---

## 自動採点基準

### テスト項目一覧

| ID | 項目 | 配点 | 検証方法 |
|----|------|------|---------|
| M1-1 | 円グラフのSVG要素が存在する | 5 | `[data-testid="circle-chart"]` の存在確認 |
| M1-2 | 活動セグメントが正しい角度で描画される | 8 | SVG path の d 属性を解析し角度を検証 |
| M1-3 | 時刻ラベル(0,3,6,9,12,15,18,21)が表示される | 4 | テキスト要素の存在・内容確認 |
| M1-4 | 未登録時間帯がグレー(`#E5E7EB`)で表示される | 4 | fill 色の確認 |
| M1-5 | 中央に日付(`YYYY/MM/DD`形式)が表示される | 4 | テキスト内容の確認 |
| M2-1 | 追加ダイアログが開閉する | 4 | ボタンクリック後の DOM 確認 |
| M2-2 | バリデーション不正時に保存ボタンが disabled | 4 | disabled 属性の確認 |
| M2-3 | 活動追加後に円グラフに反映される | 8 | セグメント数の増加確認 |
| M2-4 | カテゴリ選択で色が自動適用される | 4 | 追加された活動の fill 色確認 |
| M3-1 | 活動一覧が存在し活動が表示される | 5 | リスト要素の存在・子要素数確認 |
| M3-2 | 開始時刻が `HH:MM` フォーマットで表示される | 5 | `/^\d{2}:\d{2}$/` の正規表現マッチ |
| M3-3 | 活動時間が `H:MM` フォーマットで表示される | 5 | `/^\d+:\d{2}$/` の正規表現マッチ |
| M4-1 | 削除確認ダイアログが表示される | 5 | AlertDialog の存在確認 |
| M4-2 | 削除後にグラフと一覧が更新される | 5 | セグメント数・リスト要素数の減少確認 |
| S1-1 | クイック追加ボタンが6つ表示される | 5 | `data-testid` の存在確認 |
| S1-2 | クイック追加でカテゴリが自動選択される | 5 | ダイアログ内の選択値確認 |
| S2-1 | 日付の前後移動で日付ラベルが変化する | 5 | 日付ラベルのテキスト変化確認 |
| S2-2 | 「今日」ボタンで当日の日付に戻る | 5 | 日付ラベルの内容確認 |
| C1-1 | カテゴリ別合計時間・割合が正しく表示される | 5 | テキスト内容の数値検証 |
| C2-1 | localStorage にデータが保存・復元される | 5 | `localStorage.getItem` の内容確認 |

**合計: 100点**

---

## 制約事項

- **外部チャートライブラリ禁止**: D3.js, Chart.js, Recharts 等は使用不可。SVGは自前で描画すること
- shadcn/ui のコンポーネントは自由に使用してよい（Dialog, Button, Input, Select, AlertDialog 等）
- **レスポンシブ対応は不要**（デスクトップ表示のみ、幅800px想定）
- **ダークモード対応は不要**
- **アクセシビリティ対応はスコープ外**
- テストは `src/__tests__/` ディレクトリに配置すること
- 仕様書に記載のない機能は実装しないこと

---

## 提出要件

1. `npm run build` がエラーなく完了すること
2. `npm run dev` で開発サーバーが起動すること
3. `npm test` で全テストが実行可能であること
4. TypeScriptの型エラーがないこと（`npx tsc --noEmit`）
5. git で commit・push されていること
